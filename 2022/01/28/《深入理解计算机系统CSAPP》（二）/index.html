<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>《深入理解计算机系统CSAPP》（二） | Sisyphus's blog</title><meta name="keywords" content="学习笔记"><meta name="author" content="RyanFcr"><meta name="copyright" content="RyanFcr"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一直很想看的一本书，寒假开始自学，边学边记一些笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="《深入理解计算机系统CSAPP》（二）">
<meta property="og:url" content="http://example.com/2022/01/28/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9FCSAPP%E3%80%8B%EF%BC%88%E4%BA%8C%EF%BC%89/index.html">
<meta property="og:site_name" content="Sisyphus&#39;s blog">
<meta property="og:description" content="一直很想看的一本书，寒假开始自学，边学边记一些笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/mmexport1612147589760.jpg">
<meta property="article:published_time" content="2022-01-27T16:00:00.000Z">
<meta property="article:modified_time" content="2022-02-03T06:41:56.543Z">
<meta property="article:author" content="RyanFcr">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/mmexport1612147589760.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/01/28/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9FCSAPP%E3%80%8B%EF%BC%88%E4%BA%8C%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":100},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: RyanFcr","link":"链接: ","source":"来源: Sisyphus's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '《深入理解计算机系统CSAPP》（二）',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-02-03 14:41:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 总览</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 一些宝藏</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./img/mmexport1612147589760.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Sisyphus's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 总览</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 一些宝藏</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">《深入理解计算机系统CSAPP》（二）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-27T16:00:00.000Z" title="发表于 2022-01-28 00:00:00">2022-01-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-03T06:41:56.543Z" title="更新于 2022-02-03 14:41:56">2022-02-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/2022%E5%AF%92%E5%81%87/">2022寒假</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="《深入理解计算机系统CSAPP》（二）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>《深入理解计算机系统CSAPP》（二）</h1>
<p>  在Github上找到这样两个项目，相信对自学CSAPP的同学会有帮助</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://github.com/EugeneLiu/translationCSAPP">EugeneLiu/translationCSAPP: 为 CSAPP 视频课程提供字幕，翻译 PPT，Lab。 (github.com)</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://github.com/Exely/CSAPP-Labs">Exely/CSAPP-Labs: Solutions and Notes for Labs of Computer Systems: A Programmer’s Perspective 3rd Editon // 《深入理解计算机系统》第三版的实验文件、解答与笔记 (github.com)</a></p>
</li>
</ul>
<p>  B站视频链接👇</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1iW411d7hd?p=1">【精校中英字幕】2015 CMU 15-213 CSAPP 深入理解计算机系统 课程视频_哔哩哔哩_bilibili</a></p>
<p>  笔记主要由书上章节分类，而非课程视频的分集。</p>
<h2 id="Lecture-03-Machine-Level-Programming📝">Lecture 03 Machine Level Programming📝</h2>
<h3 id="History-of-Intel-Processors-and-architectures">History of Intel Processors and architectures</h3>
<ul>
<li>使用机器语言可以获得
<ul>
<li>PC</li>
<li>Register</li>
<li>Condition Codes</li>
</ul>
</li>
<li>Intel的处理器系列被称为x86，x86对于英特尔处理器来说是一个口头的称谓，原因是第一个芯片被称为8086，然后他们跳过了81，随后推出了8286、8386等等，共同点都有86，所以人们称它位x86。
<ul>
<li>8086，8086是第一个16位微处理器，它出现在1978年。</li>
<li>i386</li>
<li>……向后兼容</li>
</ul>
</li>
<li>CISC 复杂指令集 vc RISC 精简指令集（ARM，Risc-v）</li>
<li>IA32，x86-64</li>
<li>竞争对手AMD
<ul>
<li>率先突破x86-64</li>
</ul>
</li>
</ul>
<h3 id="C，assembly，machine-code">C，assembly，machine code</h3>
<ul>
<li>
<p>ARM：Acorn RISC Machine</p>
<ul>
<li>功耗更低，更简单</li>
</ul>
</li>
<li>
<p>一些定义的明确</p>
<ul>
<li>ISA：指令集架构，机器级程序的格式和行为，定义了处理器状态、指令的格式，以及每条指令对状态的影响。
<ul>
<li>Intel：x86，IA32</li>
<li>ARM：很多手机上的</li>
</ul>
</li>
<li>微架构microarchitecture是ISA这个架构的实现</li>
</ul>
</li>
<li>
<p>对于机器级编译两层抽象很重要</p>
<ul>
<li>ISA</li>
<li>虚拟内存</li>
</ul>
</li>
<li>
<p>将C代码翻译为目标代码的过程：</p>
<ol>
<li><strong>预处理器</strong>会扩展源代码，插入所有用<code>#include</code>指令的文件，扩展所有用<code>#define</code>声明指定的宏。</li>
<li><strong>编译器</strong>基于编程语言的规则、目标机器的指令集和操作系统的惯例，会将源代码转换为汇编代码作为输出，给出程序的每一条指令。</li>
<li><strong>汇编器</strong>将汇编代码转化为二进制目标代码文件，它是机器代码的一种形式，包含了所有指令的二进制表示，但是还没有填入全局值的地址。</li>
<li><strong>链接器</strong>将目标代码文件和实现库函数的代码合并，产生最终可执行代码文件。</li>
</ol>
<ul>
<li>.c——&gt;.s——&gt;.o——&gt;p</li>
<li>编译器——&gt;汇编器——&gt;链接器</li>
<li>-og优化</li>
<li>汇编代码中以“.”开头的行都是指导汇编器和链接器工作的伪代码，可以忽略</li>
<li>变量所有名称在汇编、机器代码级别完全丢失了，变成了寄存器和内存中的某个位置。</li>
</ul>
</li>
<li>
<p><strong>编译器</strong></p>
</li>
</ul>
<p> <code>gcc - Og -S xx.c </code>得到<code>xx.s </code></p>
<ul>
<li><strong>汇编器</strong></li>
</ul>
<p> <code>gcc -Og -c xx.c</code>进行编译和汇编，生成二进制文件<code>xx.o</code>，可以通过反汇编器，<code>objdump -d xx.o</code> ，将可执行文件转换成汇编代码</p>
<p> 发现</p>
<ol>
<li>每个指令需要的字节数不同，有的两个，有的三个……</li>
<li>每个指令有自己对应的编码</li>
<li>反汇编得到的汇编代码和直接生成的有差异</li>
</ol>
<p> 同样可以使用<code>gdb</code>然后输入<code>disassemble</code>来反汇编代码</p>
<ul>
<li><strong>链接器</strong></li>
</ul>
<p> 使用链接器将目标代码文件转化为可执行代码。要求：目标代码文件中必须含有一个<code>main</code>函数，作为程序的入口。按<strong>书上</strong>的指令：<code>gcc -Og -o prog main.c mstore.c</code>，链接了main.c和mstore.c，生成可执行文件prog。</p>
<p> 可以发现和汇编器生成的区别有：</p>
<ol>
<li>链接器将代码移到了新的地址范围内。</li>
<li>链接器补充了调用函数<code>mult2</code>需要使用的地址。</li>
<li>多了两行<code>nop</code>，可以使得函数代码变成16字节，更好放置下一个代码。</li>
</ol>
<ul>
<li>数据格式
<ul>
<li>不区分符号和无符号的存储方式</li>
<li>指针也是以数字的形式存储的</li>
<li>b 字节 8</li>
<li>w 字 16</li>
<li>l 双字 32</li>
<li>q 四字 64</li>
<li>浮点数是4字节、8字节、10字节
<ul>
<li>浮点数以和整型数据完全不同的方式进行处理，并且使用完全不同的寄存器组。</li>
</ul>
</li>
<li>数据结构这些是编译器实现的</li>
</ul>
</li>
<li>每条指令能做的事情比较有限</li>
</ul>
<h3 id="Assembly-Basics：Registers，operands，move">Assembly Basics：Registers，operands，move</h3>
<ul>
<li>一个x86-64的CPU中包含16个存储64位值的通用目的寄存器，可以用来存储整数数据和指针。有些寄存器有<strong>特殊用途</strong>，是约定俗成的
<ul>
<li>sp 栈指针</li>
<li>ecx count</li>
<li>e<strong>b</strong>c —— base等等 但是其实我们已经不需要知道了</li>
<li>%r 64位</li>
<li>%e 低32位</li>
<li>可以对低的1、2、4、8字节进行操作</li>
</ul>
</li>
</ul>
<h4 id="操作数指示符（Mov类）">操作数指示符（Mov类）</h4>
<p> 大多数指令由一个或多个操作数（Operand），指示出一个操作中要使用的元数据值，以及放置结果的目的位置。</p>
<p> 操作数包含三种类型：</p>
<ul>
<li>**立即数（Immediate）：**用来表示常数值，书写格式是在<code>$</code>后面跟一个标准C表示法表示的整数，比如<code>$-577</code></li>
<li>**寄存器（Register）：**表示某个寄存器的内容。</li>
<li>**内存引用：**它会根据计算出来的地址访问某个内存位置。有不同的寻址模式，最常用的是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mi>m</mi><mi>m</mi><mo stretchy="false">(</mo><msub><mi>r</mi><mi>b</mi></msub><mo separator="true">,</mo><msub><mi>r</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo><mo>=</mo><mi>M</mi><mi>e</mi><mi>m</mi><mo stretchy="false">[</mo><mi>R</mi><mi>e</mi><mi>g</mi><mo stretchy="false">[</mo><mi>R</mi><mi>b</mi><mo stretchy="false">]</mo><mo>+</mo><mi>S</mi><mo>∗</mo><mi>R</mi><mi>e</mi><mi>g</mi><mo stretchy="false">[</mo><mi>R</mi><mi>i</mi><mo stretchy="false">]</mo><mo>+</mo><mi>D</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">Imm(r_b,r_i,s) = Mem[Reg[Rb]+S*Reg[Ri]+D]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">m</span><span class="mord mathdefault">m</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">e</span><span class="mord mathdefault">m</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mclose">]</span></span></span></span> ，其中，<strong>要求寄存器大小都是64位的</strong>，才能完整索引整个虚拟内存空间，并且不能使用<code>%rsp</code>。常用括号来简化。</li>
</ul>
<p> 源操作数是一个立即数，可以直接是一个立即数或者保存在寄存器或内存里，目标操作数是一个位置，可以是寄存器或内存</p>
<p> <strong>注意</strong>：</p>
<ul>
<li>两个操作数不能同时为<strong>内存</strong>地址。如果要在两个内存位置传输数据，必须用一个寄存器进行中转。</li>
<li>使用到的寄存器大小一定要和指令最后一个字符指定的大小匹配。</li>
<li><code>movl</code>以寄存器为目的时，会将寄存器的高位4字节置0。
<ul>
<li>x86-64的惯例：任何为寄存器生成32位值的指令都会把该寄存器的高位部分置0</li>
</ul>
</li>
<li>如果用<code>movq</code>来传输立即数时，该立即数只能表示为32位补码，然后扩展到64位的值。而<code>movabsq</code>能够以任意64位立即数作为源操作数，并且只能以寄存器作为目的。</li>
</ul>
<p>寄存器可以作为临时存储的工具</p>
<p> 在将较小的源值复制到较大的目的时，提供两个类<code>MOVZ</code>和<code>MOVS</code>。<code>MOVZ</code>是将目的中剩余的字节填充0，<code>MOVS</code>是将目的剩余的字节填充符号位的值。它们每条指令后面都有两个字符，分别表示源大小和目的大小。</p>
<ul>
<li>不存在<code>movzlq</code>，可以直接使用<code>movl</code>。因为当使用<code>movl</code>传输数据到32位目的寄存器中时， 会自动将目的寄存器的高位4字节置零。</li>
<li><code>cltq</code>没有操作数，总是以<code>%eax</code>作为源寄存器，以<code>%rax</code>作为目的寄存器，等价于<code>movslq %eax,%rax</code>。</li>
</ul>
<p>综上：</p>
<ol>
<li>两个指针之间进行传输，由于是直接对内存进行操作的，所以需要先经过一个寄存器。</li>
<li>小的数据类型转换到大的数据类型，是根据前面的数据类型决定是<code>MOVZ</code>还是<code>MOVS</code>。</li>
<li>大的数据类型转换到小的数据类型时，先将其保存得到寄存器中，再将部分保存到内存中。</li>
</ol>
<h3 id="Arithmetic-logical-operations">Arithmetic &amp; logical operations</h3>
<p> 以下列出了x86-64中的一些算数和逻辑操作，除了<code>leaq</code>以外，其他都有对不同大小数据的指令。</p>
<p><img src="C:%5CUsers%5CFcr%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220124230420590.png" alt="image-20220124230420590"></p>
<ul>
<li><code>leaq S D</code>是将S计算出的地址付给寄存器D。通常会被用来执行加法和有限形式的乘法。比如对于比例变址寻址$Imm(r_b,r_i,s) $  ，得到的地址会是  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mi>m</mi><mi>m</mi><mo>+</mo><msub><mi>r</mi><mi>b</mi></msub><mo>+</mo><msub><mi>r</mi><mi>i</mi></msub><mo>∗</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">Imm+r_b+r_i*s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">m</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span> ，所以<code>leaq Imm(%rax, %rbx, s), %rcx</code>就是将 Imm+%rax+s*%rbx 保存到 %rcx 。
<ul>
<li>**注意：**目的操作数只能是寄存器。</li>
</ul>
</li>
<li>一元操作符中，操作数可以是寄存器也可以是内存地址。</li>
<li>二元操作符中，第一个操作数可以是立即数、寄存器或内存地址；第二个操作数可以是寄存器或内存地址。</li>
<li>移位操作中，第一个操作数可以是立即数或放在<strong>寄存器<code>%cl</code></strong>(rcx的low八位)中，第二个操作数可以是寄存器或内存位置。
<ul>
<li>**注意：**如果我们对w位的数据进行移位，则只考虑<code>%cl</code>中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>w</mi></mrow><annotation encoding="application/x-tex">log_{2}{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span></span>位，保证不会将数据移出边界。 比如<code>salb</code>只会考虑低3位的值，<code>salw</code>只会考虑低4位的值，以此类推。</li>
</ul>
</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li>以上操作除了右移以外，在无符号数和补码间都是通用的，也体现了补码的优势。</li>
<li>可以使用<code>xorl %edx, %edx</code>来对寄存器<code>%rdx</code>置零。</li>
</ul>
<p>Lecture06 机器级编程(控制) 观看记录📝<br>
04:00 处理器的状态（关于当前运行程序的信息，rax,rsp,rip）<br>
05:51 条件码<br>
07:55 比较指令(cmp,test)<br>
11:46 读状态码(setx,)<br>
20:14 状态分支<br>
20:36 跳转指令(这里还提及了+=的来源)<br>
26:54 C中goto语句(尽量还是不要用，不清晰)<br>
29:05 通用条件表达的转换(使用分支)<br>
31:41 条件移动<br>
35:48 条件移动的例子<br>
36:49 条件移动不适合的情况<br>
38:27 循环<br>
(总的来说就是把各种形式的循环归并成一种形式)<br>
38:29 &quot;Do while&quot;的例子(C语言)<br>
40:44 &quot;Do while&quot;的例子(编译结果)<br>
41:05 通用的&quot;Do while&quot;的Goto版本<br>
41:21 通用的&quot;While&quot;的Goto版本(1)<br>
44:07 &quot;While&quot;的例子<br>
45:34 通用的&quot;While&quot;的Goto版本(2)<br>
46:26 &quot;For Loop&quot;的形式<br>
47:38 “For” -&gt; &quot;While Loop&quot;的转换<br>
50:10 Switch语句<br>
51:01 Switch语句的例子<br>
53:44 Switch的解释(不是if-else的组合！！！超酷的)<br>
1:12:31 总结</p>
<p>Lecture07 机器级编程(过程) 观看记录📝<br>
Procedures</p>
<p>Stack Structure<br>
Calling Conventions<br>
Passing control<br>
Passing data<br>
Managing local data<br>
Illustration of Recursion<br>
2:45 ABI</p>
<p>3:50 Procedures的机制<br>
7:34 X86-64Stack<br>
ABI中调用的约定</p>
<p>14:38 过程中的控制<br>
15:32 过程中的控制(例子)<br>
21:43 过程中的数据(参数传递)<br>
23:06 过程中的数据(例子)<br>
26:19 过程中的局部变量管理<br>
26:22 栈帧<br>
31:15 一个具体的例子<br>
34:42 X86-64/Linux栈帧的结构<br>
39:06 Calling incr的例子<br>
过程调用中寄存器的使用<br>
46:29 Register保存的约定<br>
49:38 不同寄存器的用途<br>
51:17 被调用者保存寄存器的使用示例及其工作原理<br>
递归部分的解释<br>
54:31 递归的例子<br>
1:03:40 递归部分的总结</p>
<p>Lecture08 机器级编程(数据) 观看记录📝<br>
数组<br>
04:16 数组声明<br>
05:14 数组访问<br>
14:38 数组的例子<br>
21:49 数组和指针的不同(C语言部分，可看书)<br>
39:47 嵌套数组<br>
45:32 嵌套数组的访问<br>
51:04 多层数组的元素访问<br>
54:58 N<em>N的矩阵<br>
56:41 16</em>16数组访问的例子<br>
结构<br>
59:24 结构体的表示<br>
1:00:16 指向结构体成员的指针<br>
1:05:34 结构体和对齐的概念<br>
1:07:03 对齐的原则<br>
1:11:15 节省内存<br>
浮点数<br>
1:13:00 浮点数的历史<br>
1:14:44 SSE3编程<br>
1:16:01 Scalar和SIMD(真的好感动，实习时用过)<br>
1:17:13 FP运算的知识<br>
其实这里应该提及多个浮点数一起运算的加速效果</p>
<p>Lecture09 机器级编程(高级专题) 观看记录📝<br>
内存布局<br>
2:14 最大寻址大小的解释(47位)（limit）<br>
10:30 内存布局的解释(stack,heap,data,text/shared lib)<br>
12:07 内存分配的例子<br>
缓冲区溢出<br>
17:54 缓冲区问题介绍<br>
19:39 String库的缓冲区例子-gets,strcpy,strcat<br>
23:26 缓冲区问题例子<br>
32:15 缓冲区问题(缓存区溢出攻击例子)<br>
33:31 代码注入攻击解释(很有意思)<br>
36:47 当你替换代码是，如何确定注入的代码提供了准确的地址<br>
38:09 Buffer overflows的历史<br>
42:30 蠕虫和病毒的区别<br>
43:09 避免缓冲区攻击的手段<br>
43:24 避免程序中的缓冲区溢出<br>
45:28 系统级别的防御:ASLR,权限，canary(啊啊啊啊啊,canary我遇到过)<br>
1:03:51 关于这三种手段的老师的评价<br>
1:10:59 attack lab讲解<br>
1:12:59 联合体<br>
1:13:40 联合体内存分布<br>
1:15:40 字节顺序的问题</p>
<p>Lecture10 程序优化 观看记录📝<br>
01:10 整体的程序优化手段介绍<br>
03:08 性能的两条人间真实:常数因子也很重要;必须了解系统知识才能优化性能<br>
04:32 关于Compiler(编译器)的一些介绍<br>
06:32 代码移动(Code Move)，先计算需要计算的值，然后在之后一直使用这个值<br>
08:45 计算量减少(Reduction in Strength),将乘法转化为加法<br>
10:07 共享通用表达(Share Common SubExpressions),通过抽取子表达式，将其提前转化为共享变量的方式减少计算量<br>
13:00 优化中的障碍<br>
13:10 障碍1，过程调用<br>
18:08 为什么编译器无法优化这种过程调用错误,变量在变化，无法确定函数体内容<br>
21:02 障碍2，内存别名导致，重复对内存地址进行读取的问题;<br>
22:57 障碍2是由于内存别名的存在，导致程序无法确定两个内存是否完全无关，所以需要重复读取;<br>
32:11 无序执行(乱序执行)，利用指令级别的并行<br>
32:32 程序加速的例子<br>
35:13 CPE指标的引入<br>
38:30 程序加速，改进例子的极少<br>
40:35 指令级并行的基本思想<br>
44:26 超标量计算机简介<br>
45:03 流水线技术，及其如何将计算分解为一系列不同的阶段<br>
48:40 HasWell，不同阶段对应的时钟周期<br>
51:00 计算机中，顺序依赖概念的解释<br>
51:30 循环展开，对性能提高的效果展示<br>
52:50 循环展开对于不同运算的性能提高效果<br>
53:29 运算顺序改变，对于不同运算的性能提升效果<br>
61:20 Avx2指令加速<br>
66:46 条件预测，提前加载指令进行加速<br>
72:30 获得高性能程序的一些关键点</p>
<p>Lecture12 Cache Memory 观看记录📝<br>
01:09 内存的层级结构<br>
01:54 Cache的概念<br>
04:42 Cache的组织结构<br>
07:30 Cache读<br>
07:30 Cache的寻址方式<br>
10:38 Direct Mapped Cache(E = 1)<br>
20:58 E-way Set Associative Cache(E = 2)<br>
35:38 Cache写<br>
write hit<br>
36:11 wrtie through and write back(脏位)<br>
write miss<br>
37:47 write-allocate and No-write-allocate<br>
39:40 英特尔i7的cache架构<br>
42:42 Cache性能的度量:MIss Rate, Hit Time, Miss Penalty<br>
44:53 关于Cache数量度量的例子<br>
46:58 写出缓存友好的代码<br>
50:57 Memory Mountain<br>
53:48 Memory Mountain Test代码<br>
56:30 Memory Mountain可视化代码<br>
59:14 Ridges of temporal locality时间局部性的山脊<br>
1:03:53 重新排列循环<br>
1:04:01 Matrix Multiplication例子<br>
1:05:13 Miss Rate分析<br>
1:08:05 Matrix Multiplication的总结<br>
1:10:31 分块技术<br>
1:14:41 分块技术的Cache Miss分析<br>
1:16:14 Blocking的效果分析</p>
<p>Lecture13 链接观看记录📝<br>
01:51 静态链接的过程<br>
03:40 为什么要用链接：模块化，效率(编译)<br>
05:20 连接器的作用<br>
05:25 符号解析<br>
07:20 重定位<br>
09:20 三种目标文件的分类<br>
09:25 .o可重定位目标模块<br>
09:50 .out可执行文件<br>
10:15 ,so共享目标文件<br>
10:32 目标模块ELF标准<br>
10:58 目标文件的格式:header,segment header table, .text section, .rodata section,.data section,.bss section, .symtab section, .rel .txt section,.rel .data section,.debug section, section header<br>
15:13 链接器的符号分类，global symbols, external symbols, local symbols<br>
19:30 局部非静态变量 vs 局部静态变量<br>
21:30 链接器如何解决重复符号定义问题？强符号，弱符号;<br>
32:04 避免全局变量的原因<br>
36:00 重定位入口<br>
44:15 加载可执行的目标文件<br>
48:30 打包常用的函数<br>
51:06 静态链接库<br>
55:51 静态库链接的过程<br>
56:13 使用静态库的过程<br>
60:02 共享链接库<br>
62:52 动态链接的加载过程<br>
67:17 运行时的动态链接</p>
<p>杂项<br>
53:13 常用库</p>
<p>示例<br>
24:12 链接错误示例<br>
sum<br>
01:04 C程序示例<br>
18:34 符号解析的过程<br>
32:49 重定位的过程<br>
41:26 重定位后的text部分<br>
案例学习<br>
70:24 库打桩</p>
<p># Lecture14 异常控制流 异常和进程</p>
<p>02:41 异常控制流会在什么地方存在<br>
05:04 异常的定义，三种情况<br>
07:15 异常表<br>
07:46 异常的分类方法，同步异步。异步异常，中断。<br>
10:20 同步异常，陷阱和系统调用<br>
10:54 故障，页缺失，保护故障<br>
13:03 终止<br>
13:33 Linux/x86-64 常用的系统调用<br>
14:01 syscall，open<br>
15:54 故障的例子，页缺失，从磁盘到内存<br>
16:58 故障的例子，无效内存引用<br>
18:22 进程的定义<br>
19:14 进程的两个抽象。第一个，独占cpu和寄存器。第二个，拥有自己的地址空间<br>
21:02 top指令看进程<br>
21:27 多进程管理共享，上下文切换是地址空间和寄存器的变化<br>
23:40 逻辑控制流<br>
24:50 并发<br>
26:34 上下文切换的过程，用户模式和内核模式<br>
28:19 系统调用错误处理<br>
30:55 错误报告功能，unix_error<br>
31:38 错误处理包装函数，Fork<br>
32:43 进程控制函数，getpid，getppid<br>
33:11 进程的三种状态，运行，停止，终止<br>
34:18 终止进程，exit<br>
35:33 fork创建子进程，返回两次<br>
37:30 fork的例子<br>
40:03 进程图，捕捉调用fork时发生的情况。顶点是语句的执行，边对应变量<br>
41:30 进程图例子<br>
44:10 多个连续fork例子<br>
48:15 回收子进程<br>
49:00 僵尸进程<br>
49:35 系统安排init进程回收孤儿进程<br>
51:00 一个僵尸现象的例子<br>
52:41 另一个例子，父进程结束子进程没结束<br>
54:14 wait用来与子进程同步并回收它们<br>
55:18 wait工作原理的简单示例<br>
57:35 复杂的例子，waitpid函数<br>
59:59 execve运行不同的程序<br>
1:03:10 新程序开始时的栈帧结构<br>
1:05:56 execve的例子，用途<br>
1:10:37 总结。异常，进程，fork，exit，wait，waitpid，execve</p>
<p>Lecture15 信号和非本地跳转</p>
<p>00:52 linux进程体系，init创建守护进程Daemon，login shell<br>
02:40 shell，bash<br>
03:16 一个简单shell的main例程<br>
04:17 eval求值<br>
08:45 简单shell例程的问题，内存泄漏<br>
08:55 异常控制流解决问题<br>
09:29 信号的定义，Linux常见信号<br>
13:20 信号的概念：发送信号<br>
15:08 信号的概念：接受信号。三种反应<br>
17:20 信号的概念：挂起和阻塞的信号<br>
20:10 发送信号，进程组<br>
21:44 kill的例子，kill -9,id前加横杠的意思<br>
24:12 键盘发送信号，ctrl+c发送sigint，默认行为终止进程，ctrl+z发送sigtstp，默认行为挂起进程<br>
24:55 ctrl+c和ctrl+z例子，ps命令，fg命令<br>
26:10 系统调用kill发送信号<br>
27:20 进程接受信号<br>
28:33 pnb<br>
30:02 信号的默认行为<br>
30:24 使用signal函数的系统调用修改默认行为<br>
32:25 安装处理程序的例子<br>
33:59 信号处理程序看作并发流<br>
38:00 信号处理程序被其它信号处理程序中断<br>
39:01 阻塞和接触阻塞信号<br>
40:10 用sigprocmasks函数阻塞和解除阻塞信号<br>
42:13 安全的信号处理程序<br>
44:32 编写安全程序的经验参考，6条经验<br>
49:28 异步信号安全，Linux安全的系统级函数<br>
53:08 作者开发的安全的I/O包<br>
54:15 例子fork14<br>
59:38 可移植信号处理，书上P541<br>
63:10 作业列表的例子同步错误 书上P542<br>
67:30 消除竞争的一种方法，书上P543<br>
70:18 显式地等待信号<br>
76:05 sigsuspend</p>
<p># Lecture18 虚拟内存系统</p>
<p>00:19 简单的内存系统的例子，和书上P574一样<br>
10:54 另一个例子<br>
17:41 虚拟内存在Core i7/Linux下如何工作<br>
24:58 Core i7端到端的地址翻译<br>
28:48 Intel系统页表条目的结构，第一二三级<br>
31:38 第四级页表条目格式<br>
33:25 Core i7页表翻译<br>
36:11 加速访问L1高速缓存<br>
38:36 Liunx虚拟内存系统。内核产生的也是虚拟地址<br>
44:12 Linux虚拟内存区域<br>
46:38 缺页异常处理<br>
50:53 内存映射<br>
53:40 再看共享对象<br>
56:22 私有写时复制对象<br>
60:49 fork函数，内核只拷贝所有内核数据结构，mm_struct, area_struct和页表。将两个进程的每个页面都标记为只读，每个区域结构都标记为私有写时复制<br>
65:13 execve系统调用。删除当前进程的所有area_struct和页表，为新区域创建新的<br>
71:34 mmap函数用户级内存映射<br>
75:34 mmap的例子</p>
<p># Lecture19 动态内存分配 基础概念</p>
<p>00:48 本周内容主题：储存器分配，其工作原理，如何使用它们管理虚拟内存<br>
01:05 动态内存分配器，堆<br>
01:56 块被分配和释放，显式分配器malloc和free，隐式分配器使用垃圾回收（Java等）<br>
03:37 malloc，free，calloc初始化分配块为0,realloc调整之前malloc块的大小，sbrk增长和缩小堆<br>
05:40 malloc例子<br>
07:17 今天实现malloc和free等功能，简化假设，内存地址不按字节，按word，假设word是4个字节（int的大小）<br>
08:38 malloc，free分配释放块的例子<br>
10:02 分配器的要求和目标各种约束<br>
12:24 速度和内存效率指标，吞吐量。在malloc和free序列最大化吞吐量和使内存利用率尽可能高<br>
14:01 使内存利用率尽可能高，衡量使用堆的效率。有效载荷/堆的大小<br>
17:24 碎片。内部碎片。<br>
18:58 外部碎片。堆中有足够内存但没有足够大的空闲块<br>
21:36 实现问题。free怎么知道块的大小？怎样追踪空闲块？如何处理剩余空间？如何选择空闲块？如何处理刚刚被释放的块？<br>
23:09 知道要释放多少。块头部编码了块大小<br>
24:15 追踪空闲块。隐式空闲列表，空闲块通过头部的隐含字段连接，分配器可以遍历。<br>
29:00 构建隐式空闲列表。<br>
31:51 需要块的大小和分配状态，不需要两个word，利用块需要边界对齐，用一个word<br>
33:52 隐式空闲列表的细节。结束块已分配大小为0<br>
36:46 找到空闲块。第一次找代码。之后找从离开的地方找。找最佳匹配，扫描所有，速度较慢，但提高了效率。<br>
39:30 分割空闲块</p>
<p>42:34 如何释放一个块。清除已分配的标志就可以，不过会造成外部碎片，得到两个连续的空闲块。<br>
43:57 合并空闲块，释放的时候检查前后是否也是空闲块。找前面的块要重头遍历，搜索时间太长<br>
46:13 解决方法：Knuth提出的边界标记技术，把块的头部复制到脚部，找上一个的脚部就能根据大小找到头部<br>
49:55 合并时的4种情况<br>
52:41 边界标记的缺点，它们是内部碎片。优化方法：已分配的块不需要脚部，怎样知道前面块是已分配的？把编码的 已分配/空闲 位放在当前块多出来的低位里。妙啊！<br>
59:38 总结关键策略。放置策略，不错的适配接近最佳适配。分割策略，处理剩下的部分。合并策略，每次free合并还是扫描合并<br>
64:37 隐式列表总结。简单的分配器，各种属性。做shell lab</p>
<p># Lecture 22 网络编程 第2部分</p>
<p>01:30 <code>hostinfo</code>程序<br>
04:35 回顾上次的概述图，单个连接的服务器，<code>getaddrinfo</code><br>
07:56 <code>sockaddr</code>，<code>sockaddr_in</code>结构<br>
10:03 <code>getaddrinfo</code>，<code>freeaddrinfo</code>，<code>gai_strerror</code><br>
12:54 <code>getaddrinfo</code>返回的<code>addrinfo</code>数据结构<br>
13:58 <code>getnameinfo</code>功能<br>
15:12 <code>hostinfo</code>程序<br>
20:32 回到概述图，<code>socket</code>是本地调用，为此连接分配一些数据结构。<code>connect</code>就像拨打电话<br>
21:58 辅助函数，<code>open_clientfd</code>，<br>
28:36 <code>open_listenfd</code><br>
35:45 例子echo，一个客户端<br>
40:17 实现，客户端代码<br>
42:19 服务端代码<br>
46:43 telnet<br>
48:21 http<br>
50:56 静态内容html 动态内容<br>
51:58 URL<br>
52:57 HTTP请求<br>
53:31 HTTP回应<br>
54:06 演示<br>
57:38 书上tiny代码建议看下<br>
59:40 serve_static<br>
63:55 动态内容<br>
67:35 fork/exec<br>
68:33 CGI，通用网关接口<br>
69:44 创建环境变量，查询字符串<br>
70:54 动态内容GET<br>
72:39 对两个整数求和的CGI程序</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">RyanFcr</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/01/28/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9FCSAPP%E3%80%8B%EF%BC%88%E4%BA%8C%EF%BC%89/">http://example.com/2022/01/28/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9FCSAPP%E3%80%8B%EF%BC%88%E4%BA%8C%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Sisyphus's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></div><div class="post_share"><div class="social-share" data-image="/./img/mmexport1612147589760.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2022/01/26/NFT%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/"><img class="prev-cover" src="/./img/nft.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">NFT：从入门到精通</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/01/18/Crash%20Course%20Computer%20Science/" title="Crash Course Computer Science"><img class="cover" src="/./img/267379862.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-18</div><div class="title">Crash Course Computer Science</div></div></a></div><div><a href="/2022/01/23/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9FCSAPP%E3%80%8B%EF%BC%88%E4%B8%80%EF%BC%89/" title="《深入理解计算机系统CSAPP》（一）"><img class="cover" src="/./img/mmexport1604462635742.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-23</div><div class="title">《深入理解计算机系统CSAPP》（一）</div></div></a></div><div><a href="/2022/01/26/NFT%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/" title="NFT：从入门到精通"><img class="cover" src="/./img/nft.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-26</div><div class="title">NFT：从入门到精通</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NTIyNS8zMTY5Mg"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">《深入理解计算机系统CSAPP》（二）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-03-Machine-Level-Programming%F0%9F%93%9D"><span class="toc-text">Lecture 03 Machine Level Programming📝</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#History-of-Intel-Processors-and-architectures"><span class="toc-text">History of Intel Processors and architectures</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C%EF%BC%8Cassembly%EF%BC%8Cmachine-code"><span class="toc-text">C，assembly，machine code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Assembly-Basics%EF%BC%9ARegisters%EF%BC%8Coperands%EF%BC%8Cmove"><span class="toc-text">Assembly Basics：Registers，operands，move</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8C%87%E7%A4%BA%E7%AC%A6%EF%BC%88Mov%E7%B1%BB%EF%BC%89"><span class="toc-text">操作数指示符（Mov类）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arithmetic-logical-operations"><span class="toc-text">Arithmetic &amp; logical operations</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/./img/mmexport1612147589760.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 By RyanFcr</div><div class="footer_custom_text">✨很高兴认识你🦄</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: '[object Object]',
      })
      true && mermaid.init()
    })
  }
}</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (true) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>